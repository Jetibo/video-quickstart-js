# Twilio Video QuickStart - Vanilla JavaScript

This is a vanilla JavaScript conversion of the Twilio Video QuickStart project. All jQuery code has been replaced with native JavaScript while maintaining the same functionality.

## What's Different from the Original?

### Converted from jQuery to Vanilla JavaScript
- **DOM Selection**: `$('#id')` → `document.getElementById('id')` and `querySelector()`
- **Event Handlers**: `$element.click(handler)` → `element.addEventListener('click', handler)`
- **DOM Manipulation**: `$element.html()` → `element.innerHTML`, `.css()` → `.style`, `.addClass()` → `.classList.add()`
- **Attributes**: `$element.attr()` → `element.getAttribute()` and `.setAttribute()`

### Added Extensive Comments
Every function and major code block now has detailed comments explaining:
- What the code does
- Why it's needed
- How Twilio Video features work
- Important browser behaviors (especially mobile)

### Note on Bootstrap Modals
Bootstrap 4 modals still require jQuery, so we kept jQuery in the HTML file specifically for the modal functionality. To fully remove jQuery, you would need to either:
- Use a vanilla JS modal library
- Write custom modal code
- Upgrade to Bootstrap 5 (which doesn't require jQuery)

## Project Structure

```
quickstart-vanilla/
├── src/                    # Source JavaScript files
│   ├── index.js           # Main entry point - handles app initialization
│   ├── joinroom.js        # Room joining and participant management
│   ├── selectmedia.js     # Microphone and camera selection
│   ├── selectroom.js      # Room name and username input
│   ├── browser.js         # Browser utilities (URL params, mobile detection)
│   ├── miclevel.js        # Microphone level indicator
│   ├── showerror.js       # Error display
│   ├── userfriendlyerror.js  # User-friendly error messages
│   └── togglepip.js       # Picture-in-picture functionality
└── public/                # Static files
    ├── index.html         # HTML page
    ├── index.css          # Styles
    └── index.js           # Compiled bundle (generated by browserify)
```

## How It Works

### Application Flow

1. **Load Page** → Check browser support
2. **Select Microphone** → User chooses microphone, sees audio level indicator
3. **Select Camera** → User chooses camera, sees video preview
4. **Join Room** → User enters room name and username
5. **Fetch Token** → Request access token from server
6. **Connect to Room** → Join Twilio Video room with selected devices
7. **Video Chat** → See all participants, dominant speaker highlighted
8. **Leave Room** → Disconnect and return to room selection

### Key Concepts

#### Participants
- **Local Participant**: You (your own video/audio)
- **Remote Participants**: Other people in the room
- **Active Participant**: The one shown in the main video area
- **Dominant Speaker**: The person talking the most (detected by Twilio)
- **Pinned Participant**: User manually selected someone to stay in main view

#### Tracks
- **LocalTrack**: Your camera or microphone
- **RemoteTrack**: Another participant's camera or microphone
- **Publishing**: Sending your tracks to the room
- **Subscribing**: Receiving tracks from other participants

#### Room Types
- **Peer-to-Peer**: Direct connection between 2 participants (limited features)
- **Group Room**: Twilio's media server manages connections (more features)
  - Bandwidth profiles
  - Dominant speaker detection
  - Video priority control
  - Network quality monitoring

## Setup Instructions

### Prerequisites
- Node.js installed
- Twilio account with Video API enabled

### Installation

1. Install dependencies (from the root of the project):
   ```bash
   npm install
   ```

2. Set up your Twilio credentials in the server (if not already done)

3. Build the JavaScript bundle:
   ```bash
   # From the quickstart-vanilla directory
   npm run build
   ```
   
   Or add this to your package.json scripts:
   ```json
   {
     "scripts": {
       "build:vanilla": "browserify quickstart-vanilla/src/index.js -o quickstart-vanilla/public/index.js"
     }
   }
   ```

4. Start the server (from the root):
   ```bash
   npm start
   ```

5. Open your browser to:
   ```
   http://localhost:3000/quickstart-vanilla/public/
   ```

## Learning Guide

### Understanding the Code

The code is heavily commented to help you learn. Start with these files in order:

1. **[index.js](src/index.js)** - Understand the overall flow
2. **[selectmedia.js](src/selectmedia.js)** - Learn how device selection works
3. **[joinroom.js](src/joinroom.js)** - See how rooms and participants work
4. **[browser.js](src/browser.js)** - Simple utilities to understand

### Key Functions to Study

#### Main Application Flow
- `selectMicrophone()` - Start of device selection
- `selectCamera()` - Camera selection with preview
- `selectAndJoinRoom()` - Room joining logic
- `joinRoom()` - Core video chat functionality

#### Participant Management
- `participantConnected()` - Handle someone joining
- `participantDisconnected()` - Handle someone leaving
- `setActiveParticipant()` - Control main video display
- `trackPublished()` - Handle audio/video tracks

#### UI Interactions
- `setupParticipantContainer()` - Create thumbnail UI
- `attachTrack()` - Show video/audio in UI
- `detachTrack()` - Remove video/audio from UI

### Twilio Video Features Explained

#### ConnectOptions (in index.js)
```javascript
const connectOptions = {
  bandwidthProfile: {
    video: {
      dominantSpeakerPriority: 'high',  // Better quality for speaker
      mode: 'collaboration',             // Optimized for video calls
      clientTrackSwitchOffControl: 'auto' // Smart track management
    }
  },
  dominantSpeaker: true,     // Enable speaker detection
  maxAudioBitrate: 16000,    // Limit audio bandwidth
  preferredVideoCodecs: [    // Use VP8 with simulcast
    { codec: 'VP8', simulcast: true }
  ],
  video: { height: 720, frameRate: 24, width: 1280 }
};
```

#### Mobile Considerations
- Camera stops when app is backgrounded
- Need to handle `visibilitychange` event
- Use `pagehide` instead of `beforeunload` on iOS
- Limit bandwidth to save cellular data

#### Video Priority
When you click a participant to pin them:
- Their video priority is set to 'high'
- They get better video quality
- They stay in the main view even when others speak

## Common Customizations

### Change Video Quality
In [index.js](src/index.js), modify:
```javascript
video: { height: 1080, frameRate: 30, width: 1920 }  // 1080p @ 30fps
```

### Disable Dominant Speaker
In [index.js](src/index.js):
```javascript
dominantSpeaker: false  // Everyone can be active manually
```

### Change Audio Bitrate
In [index.js](src/index.js):
```javascript
maxAudioBitrate: 32000  // Higher quality for music
```

### Hide Picture-in-Picture
Already hidden if browser doesn't support it. To always hide:
```javascript
togglePipButton.style.display = 'none';
```

## Troubleshooting

### "This browser is not supported"
- Update to a modern browser (Chrome, Firefox, Safari, Edge)
- Check [Twilio's browser support](https://www.twilio.com/docs/video/javascript#supported-browsers)

### "Permission denied" errors
- Click "Allow" when prompted for camera/microphone
- Check browser settings to ensure permissions are granted
- Make sure you're using HTTPS (or localhost)

### No video showing
- Check if camera LED is on (camera is active)
- Look for errors in browser console (F12)
- Try a different camera if you have multiple

### Mobile issues
- Ensure app has permissions in iOS/Android settings
- Close other apps that might be using the camera
- Check if camera works in other apps

## Additional Resources

- [Twilio Video JavaScript SDK Docs](https://www.twilio.com/docs/video/javascript)
- [Twilio Video Best Practices](https://www.twilio.com/docs/video/build-js-video-application-recommendations-and-best-practices)
- [Understanding Rooms](https://www.twilio.com/docs/video/tutorials/understanding-video-rooms)
- [Bandwidth Profile API](https://www.twilio.com/docs/video/tutorials/using-bandwidth-profile-api)

## Next Steps

Once you understand this code, you can:
1. Add screen sharing ([example](../examples/screenshare/))
2. Add data tracks for chat ([example](../examples/datatracks/))
3. Monitor network quality ([example](../examples/networkquality/))
4. Add video filters ([example](../examples/localvideofilter/))
5. Build your own custom video application!

## Questions?

The code is extensively commented, but if something is unclear:
1. Read the comments in the specific file
2. Check the Twilio documentation
3. Look at the original jQuery version for comparison
4. Search the [Twilio community](https://www.twilio.com/community)
